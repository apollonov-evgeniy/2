-- drop table  data;
CREATE TABLE data(
value varchar(512)
);
INSERT INTO data(value) values ('<div>
<p>0</p>
<h1>Литература на английском языке</h1>
<p class="title">Moab is my Washpot</p>
<p class="author">Fry S.</p>
<p class="price">1150 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>1</p>
<h1>История. Приключения</h1>
<p class="title">Остров Сокровищ : роман</p>
<p class="author">Стивенсон Р. Л.</p>
<p class="price">1480 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>2</p>
<h1>Современная отечественная проза</h1>
<p class="title">Тайное имя - ЙХВХ : шпионский роман-фантазия</p>
<p class="author">Гиршович Л.</p>
<p class="price">1660 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>3</p>
<h1>Современная отечественная проза</h1>
<p class="title">Жених был в весь черных штанах : рассказы</p>
<p class="author">Добровинский А.</p>
<p class="price">950 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>4</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Грешница : роман</p>
<p class="author">Герритсен Т.</p>
<p class="price">210 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>5</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Комната мертвых : роман</p>
<p class="author">Тилье Ф.</p>
<p class="price">210 ?</p>
</div>');
INSERT INTO data(value) values ('<div><p>6</p>
<h1>Проза</h1>
<p class="title">Избранный</p>
<p class="author">Рубенс Б.</p>
<p class="price">760 ?</p>
<div>');
INSERT INTO data(value) values ('
</div>
<p>7</p>
<h1>Фольклор. Мифология. Эпос</h1>
<p class="title">Русские народные сказки А. Н. Афанасьева </p>
<p class="price">61400 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>8</
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Утраченный символ : роман</p>
<p class="author">Браун Д.</p>
<p class="price">310 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>9</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Ангелы и демоны : роман</p>
<p class="author">Браун Д.</p>
<p class="price">310 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>10</p>
<h1>Проза</h1>
<p class="title">Бремя страстей человеческих : роман</p>
<p class="author">Моэм С.</p>
<p class="price">340 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>11</p>
<h1>Юмор. Сатира</h1>
<p class="title">Супружество как точная наука : рассказы</p>
<p class="author">О. Генри.</p>
<p class="price">180 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>13</p>
<h1>Зарубежные комиксы</h1>
<p class="title">Реквием. Рыцарь-вампир. Т.3. Битва драконов. Клуб адского пламени : графические романы</p>
<p class="author">Миллс П.</p>
<p class="price">1290 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>14</p>
<h1>Зарубежные комиксы</h1>
<p class="title">Эххо. Зеркальный мир. Т.3. Секрет прешонов. Далёкий юг : графические романы</p>
<p class="author">Арлестон К.</p>
<p class="price">1290 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>15</p>
<h1>Современная отечественная проза</h1>
<p class="title">Два маленьких романа</p>
<p class="author">Гришковец Е. В.</p>
<p class="price">520 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>16</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Двойник : роман</p>
<p class="author">Герритсен Т.</p>
<p class="price">210 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>17</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Головоломка : роман</p>
<p class="author">Тилье Ф.</p>
<p class="price">210 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>19</p>
<h1>Художественная публицистика</h1>
<p class="title">Записные книжки</p>
<p class="author">Довлатов С.</p>
<p class="price">400 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>20</p>
<h1>Литература на английском языке</h1>
<p class="title">Moab is my Washpot</p>
<p class="author">Fry S.</p>
<p class="price">1150 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>21</p>
<h1>История. Приключения</h1>
<p class="title">Остров Сокровищ : роман</p>
<p class="author">Стивенсон Р. Л.</p>
<p class="price">1480 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>22</p>
<h1>Современная отечественная проза</h1>
<p class="title">Тайное имя - ЙХВХ : шпионский роман-фантазия</p>
<p class="author">Гиршович Л.</p>
<p class="price">1660 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>23</p>
<h1>Современная отечественная проза</h1>
<p class="title">Жених был в весь черных штанах : рассказы</p>
<p class="author">Добровинский А.</p>
<p class="price">950 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>24</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Грешница : роман</p>
<p class="author">Герритсен Т.</p>
<p class="price">210 ?</p>
</div>');
INSERT INTO data(value) values ('<div>
<p>25</p>
<h1>Зарубежные детективы и боевики</h1>
<p class="title">Комната мертвых : роман</p>
<p class="author">Тилье Ф.</p>
<p class="price">210 ?</p>
</div>');

commit;


SELECT * FROM data;


SELECT 

    REGEXP_REPLACE  ( 
                    REGEXP_SUBSTR(value, 'p>(.+?)<',1,1),  
                    '[p><]') 
    as id,  -- 1) в первом теге id книги
    
    REGEXP_REPLACE  (
                  REGEXP_SUBSTR(value, 'h1>(.+?)<',1,1),
                  '[h1><]') 
    As h1, -- 2) в теге h1 категория
      
    Regexp_Replace  ( --  3) в теге с классом title название книги
                    REGEXP_REPLACE(
                                    REGEXP_SUBSTR   (value, '">(.+?)<',1,1),
                                    '["><]'),
                    ':(.+)') -- затем удаляем все после :
    AS title,
     
    REGEXP_REPLACE  (  
                     REPLACE(
                            REGEXP_SUBSTR(value, 'author">(.+?)<'),
                            'author'),
                     '["><]') 
    AS author,  --   4) в теге с классом author автор книги
   
    REGEXP_SUBSTR   (
                    REGEXP_SUBSTR( value, 'price">(.+?)<'),
                    '\d+') -- оставляем только цифры
    AS price    --  5) в теге с классом price цена книги
    
FROM data;
-- в ID = 7 поле author - Null не заполнял
-- есть дубли по полям: категория, название, автор, цена, но т.к. ID разные не исправлял



